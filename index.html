diff --git a/index.html b/index.html
index 93f0927582ec85d98a423ba75b41966eba98aa20..3351a953624abac4620214d91d8ed43919ab2c07 100644
--- a/index.html
+++ b/index.html
@@ -17,19 +17,96 @@
   <div id="root"></div>
 
   <script type="text/babel">
-    const { useState, useEffect, useMemo } = React;
+    const { useState, useEffect, useMemo, useCallback } = React;
 
     // ========= Utility =========
-    function xmur3(str){let h=1779033703^str.length;for(let i=0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909);return (h^h>>>16)>>>0}}
-    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296}}
-    function seededShuffle(array, seedStr){const seed=xmur3(seedStr)();const rng=mulberry32(seed);const a=[...array];for(let i=a.length-1;i>0;i--){const j=Math.floor(rng()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a}
+    function xmur3(str){
+      let h = 1779033703 ^ str.length;
+      for(let i=0;i<str.length;i++){
+        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
+        h = h << 13 | h >>> 19;
+      }
+      return function(){
+        h = Math.imul(h ^ h >>> 16, 2246822507);
+        h = Math.imul(h ^ h >>> 13, 3266489909);
+        return (h ^ h >>> 16) >>> 0;
+      };
+    }
+
+    function mulberry32(a){
+      return function(){
+        let t = a += 0x6D2B79F5;
+        t = Math.imul(t ^ t >>> 15, t | 1);
+        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
+        return ((t ^ t >>> 14) >>> 0) / 4294967296;
+      };
+    }
+
+    function seededShuffle(array, seedStr){
+      const seed = xmur3(seedStr)();
+      const rng = mulberry32(seed);
+      const a = [...array];
+      for(let i=a.length-1;i>0;i--){
+        const j = Math.floor(rng()*(i+1));
+        [a[i],a[j]] = [a[j],a[i]];
+      }
+      return a;
+    }
+
+    function cloneValue(value){
+      if (Array.isArray(value)) return value.map(cloneValue);
+      if (value && typeof value === "object") return JSON.parse(JSON.stringify(value));
+      return value;
+    }
+
+    function hashPassword(str=""){
+      let hash = 0;
+      for(let i=0;i<str.length;i++){
+        hash = (hash << 5) - hash + str.charCodeAt(i);
+        hash |= 0;
+      }
+      return `h${Math.abs(hash)}`;
+    }
+
+    function passwordsMatch(hash, plain){
+      return hash === hashPassword(plain);
+    }
+
+    function generateId(prefix="id"){
+      const cleanPrefix = prefix.replace(/[^a-z0-9]+/gi, "").toLowerCase() || "id";
+      return `${cleanPrefix}-${Math.random().toString(36).slice(2,8)}-${Date.now().toString(36)}`;
+    }
+
+    const DEFAULT_ADMIN_USER = { id:"admin", username:"Admin", passwordHash:hashPassword("admin"), role:"admin" };
+
+    function normalizeUsers(raw){
+      const list = Array.isArray(raw) ? raw : [];
+      const normalized = list
+        .map(item => {
+          if(!item || typeof item !== "object") return null;
+          const id = typeof item.id === "string" ? item.id : generateId("user");
+          const username = typeof item.username === "string" && item.username.trim() ? item.username.trim() : "Nutzer";
+          const passwordHash = typeof item.passwordHash === "string" ? item.passwordHash : hashPassword("passwort");
+          if(id === DEFAULT_ADMIN_USER.id){
+            return { ...DEFAULT_ADMIN_USER, username, passwordHash, role:"admin" };
+          }
+          return { id, username, passwordHash, role:"user" };
+        })
+        .filter(Boolean);
+
+      if(!normalized.some(u => u.id === DEFAULT_ADMIN_USER.id)){
+        normalized.unshift({ ...DEFAULT_ADMIN_USER });
+      }
+
+      return normalized;
+    }
 
     const COLOR = {
-      BDG: { bg:"bg-yellow-50", border:"border-yellow-400", bar:"bg-yellow-400", grad:"from-yellow-400 to-amber-500", text:"text-yellow-700 dark:text-yellow-200" },
-      SPG: { bg:"bg-blue-50",   border:"border-blue-500",   bar:"bg-blue-500",   grad:"from-blue-600 to-indigo-600", text:"text-blue-700 dark:text-blue-200" },
-      StPO:{ bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
-      StGB:{ bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
-      ADMIN:{ bg:"bg-green-50",  border:"border-green-600",  bar:"bg-green-600",  grad:"from-emerald-600 to-green-600", text:"text-green-700 dark:text-emerald-200" },
+      BDG:   { bg:"bg-yellow-50", border:"border-yellow-400", bar:"bg-yellow-400", grad:"from-yellow-400 to-amber-500", text:"text-yellow-700 dark:text-yellow-200" },
+      SPG:   { bg:"bg-blue-50",   border:"border-blue-500",   bar:"bg-blue-500",   grad:"from-blue-600 to-indigo-600", text:"text-blue-700 dark:text-blue-200" },
+      StPO:  { bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
+      StGB:  { bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
+      ADMIN: { bg:"bg-green-50",  border:"border-green-600",  bar:"bg-green-600",  grad:"from-emerald-600 to-green-600", text:"text-green-700 dark:text-emerald-200" },
     };
 
     const GROUPS = [
@@ -55,62 +132,126 @@
       { id:"bdg-39-ma-1", question:"¬ß 39 BDG (Dienstzuteilung): Unter welchen Bedingungen ist eine Zuteilung ohne schriftliche Zustimmung √ºber 90 Tage zul√§ssig? W√§hlen Sie alle zutreffenden.", choices:["Wenn der Dienstbetrieb auf andere Weise nicht aufrechterhalten werden kann.","Wenn sie zum Zwecke einer Ausbildung erfolgt.","Wenn wichtige private Gr√ºnde vorliegen.","Wenn der Kommandant der entsendenden Dienststelle zustimmt.","Wenn der Kommandant der Zuteilungsdienststelle zustimmt."], correct:[0,1], explain:">90 Tage ohne Zustimmung: nur zur Aufrechterhaltung des Dienstbetriebs oder zu Ausbildungszwecken.", law_ref:"BDG ¬ß 39", tags:["BDG"], last_checked:"2025-11-11", difficulty:2 },
     ];
 
+    const DEFAULT_FILTER = { tags: [], difficulty: 0 };
+    const DEFAULT_METRICS = { totalAttempts: 0, totalCorrect: 0, attemptedIds: {}, correctIds: {} };
+
     // ========= Helpers =========
     function useLocalStorage(key, initial){
-      const [state,setState]=useState(()=>{try{const s=localStorage.getItem(key);return s?JSON.parse(s):initial;}catch{return initial;}});
-      useEffect(()=>{try{localStorage.setItem(key,JSON.stringify(state));}catch{}},[key,state]);
+      const [state,setState]=useState(()=>{
+        try{
+          const stored = localStorage.getItem(key);
+          if(stored !== null) return JSON.parse(stored);
+        }catch{}
+        return cloneValue(initial);
+      });
+      useEffect(()=>{
+        try{ localStorage.setItem(key, JSON.stringify(state)); }catch{}
+      },[key,state]);
       return [state,setState];
     }
 
-    function rankFor(score){const r=[...RANKS].reverse().find(r=>score>=r.min);return r? r.title : RANKS[0].title}
+    function useUsers(){
+      const [users, setUsersState] = useState(() => {
+        try{
+          const saved = JSON.parse(localStorage.getItem("users") || "null");
+          if(Array.isArray(saved) && saved.length){
+            return normalizeUsers(saved);
+          }
+        }catch{}
+        return normalizeUsers([DEFAULT_ADMIN_USER]);
+      });
 
-    function ProgressBar({ value, className="" }){
-      return (
-        <div className={`w-full h-2 bg-gray-200 rounded-full overflow-hidden ${className}`}>
-          <div className="h-2 bg-blue-600 transition-all" style={{ width: `${Math.min(100, Math.max(0, value))}%` }} />
-        </div>
-      );
+      useEffect(()=>{
+        try{ localStorage.setItem("users", JSON.stringify(users)); }catch{}
+      },[users]);
+
+      const setUsers = useCallback((updater) => {
+        setUsersState(prev => {
+          const next = typeof updater === "function" ? updater(prev) : updater;
+          return normalizeUsers(next);
+        });
+      }, []);
+
+      return [users, setUsers];
     }
 
-    function Chip({ children, className="" }){
-      return <span className={`px-2 py-1 text-xs rounded-full border mr-2 mb-2 inline-block ${className}`}>{children}</span>;
+    function useUserLocalStorage(userId, key, initial){
+      const storageKey = userId ? `${userId}:${key}` : null;
+      const [state, setState] = useState(() => cloneValue(initial));
+
+      useEffect(() => {
+        if(!storageKey){
+          setState(cloneValue(initial));
+          return;
+        }
+        try{
+          const raw = localStorage.getItem(storageKey);
+          if(raw !== null){
+            setState(JSON.parse(raw));
+          } else {
+            setState(cloneValue(initial));
+          }
+        }catch{
+          setState(cloneValue(initial));
+        }
+      }, [storageKey]);
+
+      useEffect(() => {
+        if(!storageKey) return;
+        try{ localStorage.setItem(storageKey, JSON.stringify(state)); }catch{}
+      }, [storageKey, state]);
+
+      return [state, setState];
     }
 
-    function StatCard({ title, value, sub }){
-      return (
-        <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow">
-          <div className="text-xs text-gray-500 dark:text-gray-400">{title}</div>
-          <div className="text-2xl font-semibold mt-1">{value}</div>
-          {sub ? <div className="text-xs text-gray-500 dark:text-gray-400 mt-1">{sub}</div> : null}
-        </div>
-      );
+    function rankFor(score){
+      const r=[...RANKS].reverse().find(r=>score>=r.min);
+      return r? r.title : RANKS[0].title;
+    }
+
+    function tierWeight(tier){
+      return ({1:5,2:3,3:2,4:1.2,5:1}[tier] || 1);
     }
 
-    // Tiers
-    const MIN_TIER=1, MAX_TIER=5;
-    const getTierMap=()=>{try{return JSON.parse(localStorage.getItem('tiers')||'{}')}catch{return{}}};
-    const setTierMap=(m)=>{try{localStorage.setItem('tiers',JSON.stringify(m))}catch{}};
-    const getTier=(id)=>{const m=getTierMap();return m[id]||2};
-    const setTier=(id,t)=>{const m=getTierMap();m[id]=Math.max(MIN_TIER,Math.min(MAX_TIER,t));setTierMap(m)};
-    const tierWeight=(tier)=>({1:5,2:3,3:2,4:1.2,5:1}[tier]||1);
-    function weightedOrder(items){return [...items].map(x=>({x,k:Math.random()**(1/tierWeight(getTier(x.id)))})).sort((a,b)=>b.k-a.k).map(o=>o.x)}
+    function weightedOrder(items, tierResolver){
+      const resolve = typeof tierResolver === "function" ? tierResolver : (()=>2);
+      return [...items]
+        .map(x => ({ x, k: Math.random() ** (1 / tierWeight(resolve(x.id))) }))
+        .sort((a,b) => b.k - a.k)
+        .map(o => o.x);
+    }
 
-    const getDisplayOrder=(qid,idx)=> seededShuffle([0,1,2,3,4], `${qid}#${idx}`);
+    const getDisplayOrder = (qid, idx) => seededShuffle([0,1,2,3,4], `${qid}#${idx}`);
 
-    // Fragen-State (f√ºr echten Import/Export ersetzbar)
     function useQuestions(){
-      const [questions, setQuestions] = React.useState(() => {
+      const [questions, setQuestions] = useState(() => {
         try {
           const saved = JSON.parse(localStorage.getItem('questions') || 'null');
           return (saved && Array.isArray(saved)) ? saved : DEFAULT_QUESTIONS;
-        } catch { return DEFAULT_QUESTIONS; }
+        } catch {
+          return DEFAULT_QUESTIONS;
+        }
       });
-      React.useEffect(() => {
+      useEffect(() => {
         try { localStorage.setItem('questions', JSON.stringify(questions)); } catch {}
       }, [questions]);
       return { questions, setQuestions };
     }
 
+    function Chip({ children, className="" }){
+      return <span className={`px-2 py-1 text-xs rounded-full border mr-2 mb-2 inline-block ${className}`}>{children}</span>;
+    }
+
+    function StatCard({ title, value, sub }){
+      return (
+        <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow">
+          <div className="text-xs text-gray-500 dark:text-gray-400">{title}</div>
+          <div className="text-2xl font-semibold mt-1">{value}</div>
+          {sub ? <div className="text-xs text-gray-500 dark:text-gray-400 mt-1">{sub}</div> : null}
+        </div>
+      );
+    }
+
     function Dashboard({ stats, rank, score, reviewCount }){
       const cards = GROUPS.map(g=>({ ...stats[g.key], key:g.key }));
       return (
@@ -136,7 +277,7 @@
                     </div>
                   </div>
                 </div>
-              )
+              );
             })}
           </div>
           <div className="grid md:grid-cols-3 gap-4">
@@ -148,13 +289,14 @@
       );
     }
 
-    function QuestionCard({ q, idx, submitted, onSubmit, onNext }){
+    function QuestionCard({ q, idx, submitted, onSubmit, onNext, getTier }){
       const [selectedDisplay, setSelectedDisplay] = useState([]);
       const displayOrder = useMemo(()=> getDisplayOrder(q.id, idx), [q.id, idx]);
       useEffect(()=>{ setSelectedDisplay([]); }, [q.id, idx]);
       const toggle = (dispIdx) => setSelectedDisplay(prev => prev.includes(dispIdx)? prev.filter(x=>x!==dispIdx):[...prev, dispIdx]);
       const correctSet = new Set(q.correct);
       const group = GROUPS.find(g=>q.tags.some(t=>g.tags.includes(t))) || GROUPS[GROUPS.length-1];
+      const tierValue = getTier(q.id);
       return (
         <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-0 overflow-hidden">
           <div className={`h-2 w-full bg-gradient-to-r ${group.color.grad}`} />
@@ -163,7 +305,7 @@
               {q.tags.map(t => (<Chip key={t} className={`${group.color.bg} ${group.color.border} ${group.color.text}`}>{t}</Chip>))}
               <Chip>Schwierigkeit {q.difficulty}</Chip>
               <Chip>Stand {q.last_checked}</Chip>
-              <Chip>Tier {getTier(q.id)}</Chip>
+              <Chip>Tier {tierValue}</Chip>
             </div>
             <h2 className="text-lg font-semibold mb-4">{q.question}</h2>
             <div className="grid gap-2">
@@ -213,72 +355,399 @@
       );
     }
 
-    function App(){
-      const { questions: QUESTIONS, setQuestions } = useQuestions();
-      const [view, setView] = useLocalStorage("view","dashboard");
-      const [mode, setMode] = useLocalStorage("mode","training");
+    function UserAuthPanel({ users, setUsers, onLogin, theme, setTheme }){
+      const [mode, setMode] = useState("login");
+      const [username, setUsername] = useState("");
+      const [password, setPassword] = useState("");
+      const [error, setError] = useState("");
+      const [info, setInfo] = useState("Standard-Admin: Benutzername \"Admin\", Passwort \"admin\".");
+
+      const handleLogin = (e) => {
+        e.preventDefault();
+        setError("");
+        const trimmed = username.trim();
+        if(!trimmed){ setError("Bitte Nutzername eingeben."); return; }
+        const user = users.find(u => u.username.toLowerCase() === trimmed.toLowerCase());
+        if(!user){ setError("Nutzer nicht gefunden."); return; }
+        if(!passwordsMatch(user.passwordHash, password)){
+          setError("Passwort stimmt nicht.");
+          return;
+        }
+        onLogin(user.id);
+        setUsername("");
+        setPassword("");
+      };
+
+      const handleRegister = (e) => {
+        e.preventDefault();
+        setError("");
+        const trimmed = username.trim();
+        if(!trimmed){ setError("Bitte Nutzername angeben."); return; }
+        if(password.length < 4){ setError("Passwort muss mindestens 4 Zeichen haben."); return; }
+        if(users.some(u => u.username.toLowerCase() === trimmed.toLowerCase())){
+          setError("Nutzername bereits vergeben.");
+          return;
+        }
+        const newUser = { id: generateId("user"), username: trimmed, passwordHash: hashPassword(password), role:"user" };
+        setUsers(prev => [...prev, newUser]);
+        setInfo("Neues Profil angelegt.");
+        onLogin(newUser.id);
+        setUsername("");
+        setPassword("");
+      };
+
+      const submit = mode === "login" ? handleLogin : handleRegister;
+
+      return (
+        <div className="min-h-screen flex items-center justify-center p-6">
+          <div className="max-w-md w-full bg-white dark:bg-gray-800 rounded-2xl shadow p-6">
+            <div className="flex justify-between items-center mb-4">
+              <h1 className="text-xl font-semibold">Lerntool E1 / E2a</h1>
+              <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className="px-3 py-1 rounded-full border dark:border-gray-600 text-sm">
+                {theme==='dark' ? '‚òÄÔ∏è¬†Light' : 'üåô¬†Dark'}
+              </button>
+            </div>
+            <div className="flex gap-2 mb-4">
+              <button onClick={()=>setMode("login") } className={`flex-1 px-3 py-2 rounded-lg border ${mode==='login'? 'bg-blue-600 text-white border-blue-600':'dark:border-gray-600'}`}>Login</button>
+              <button onClick={()=>setMode("register")} className={`flex-1 px-3 py-2 rounded-lg border ${mode==='register'? 'bg-blue-600 text-white border-blue-600':'dark:border-gray-600'}`}>Registrieren</button>
+            </div>
+            <form onSubmit={submit} className="space-y-4">
+              <div>
+                <label className="text-sm font-medium block mb-1">Nutzername</label>
+                <input value={username} onChange={e=>setUsername(e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="z.B. Max" />
+              </div>
+              <div>
+                <label className="text-sm font-medium block mb-1">Passwort</label>
+                <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="mind. 4 Zeichen" />
+              </div>
+              {error && <div className="text-sm text-red-600 dark:text-red-400">{error}</div>}
+              {info && !error && <div className="text-xs text-gray-500 dark:text-gray-400">{info}</div>}
+              <button type="submit" className="w-full px-3 py-2 rounded-lg bg-blue-600 text-white">{mode==='login' ? 'Anmelden' : 'Profil anlegen'}</button>
+            </form>
+          </div>
+        </div>
+      );
+    }
+
+    function UserSwitcher({ users, activeUser, onLogout, onSwitch, onChangePassword }){
+      const others = users.filter(u => u.id !== activeUser.id);
+      return (
+        <div className="mb-6 flex flex-wrap items-center justify-between gap-3">
+          <div>
+            <div className="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Angemeldet als</div>
+            <div className="text-lg font-semibold">
+              {activeUser.username}
+              {activeUser.role === 'admin' ? <span className="ml-2 text-sm px-2 py-1 rounded-full bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-200">Admin</span> : null}
+            </div>
+          </div>
+          <div className="flex flex-wrap gap-2">
+            {others.map(u => (
+              <button key={u.id} onClick={()=>onSwitch(u.id)} className="px-3 py-1 rounded-full border dark:border-gray-600 text-sm">
+                Wechsel zu {u.username}{u.role==='admin' ? ' ‚≠ê' : ''}
+              </button>
+            ))}
+            <button onClick={onChangePassword} className="px-3 py-1 rounded-full border dark:border-gray-600 text-sm">Passwort √§ndern</button>
+            <button onClick={onLogout} className="px-3 py-1 rounded-full border dark:border-gray-600 text-sm">Abmelden</button>
+          </div>
+        </div>
+      );
+    }
+
+    function QuestionForm({ draft, onChange, onSubmit, onCancel, submitLabel, disableId }){
+      if(!draft) return null;
+      const updateField = (field, value) => onChange({ ...draft, [field]: value });
+      const updateChoice = (index, value) => {
+        const choices = draft.choices.map((c,i)=> i===index ? value : c);
+        onChange({ ...draft, choices });
+      };
+      const toggleCorrect = (index) => {
+        const has = draft.correct.includes(index);
+        const correct = has ? draft.correct.filter(i=>i!==index) : [...draft.correct, index];
+        onChange({ ...draft, correct });
+      };
+      return (
+        <form onSubmit={(e)=>{e.preventDefault(); onSubmit();}} className="space-y-4">
+          <div>
+            <label className="block text-sm font-medium mb-1">Frage-ID</label>
+            <input value={draft.id} onChange={e=>updateField('id', e.target.value)} disabled={disableId} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="z.B. bdg-101" />
+            <p className="text-xs text-gray-500 mt-1">{disableId ? 'Bestehende IDs k√∂nnen hier nicht ge√§ndert werden.' : 'Leer lassen, um automatisch eine ID zu erzeugen.'}</p>
+          </div>
+          <div>
+            <label className="block text-sm font-medium mb-1">Fragetext</label>
+            <textarea value={draft.question} onChange={e=>updateField('question', e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" rows={4} placeholder="Frage eingeben" />
+          </div>
+          <div>
+            <label className="block text-sm font-medium mb-2">Antwortoptionen (markieren Sie die richtigen Antworten)</label>
+            <div className="space-y-2">
+              {draft.choices.map((choice,index)=>(
+                <div key={index} className="flex items-center gap-2">
+                  <input type="checkbox" checked={draft.correct.includes(index)} onChange={()=>toggleCorrect(index)} />
+                  <input value={choice} onChange={e=>updateChoice(index, e.target.value)} className="flex-1 px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder={`Antwort ${index+1}`} />
+                </div>
+              ))}
+            </div>
+          </div>
+          <div className="grid md:grid-cols-2 gap-4">
+            <div>
+              <label className="block text-sm font-medium mb-1">Tags</label>
+              <input value={draft.tags.join(', ')} onChange={e=>updateField('tags', e.target.value.split(',').map(t=>t.trim()).filter(Boolean))} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="BDG, SPG" />
+            </div>
+            <div>
+              <label className="block text-sm font-medium mb-1">Rechtsgrundlage</label>
+              <input value={draft.law_ref} onChange={e=>updateField('law_ref', e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="z.B. BDG ¬ß 43" />
+            </div>
+            <div>
+              <label className="block text-sm font-medium mb-1">Schwierigkeit</label>
+              <select value={draft.difficulty} onChange={e=>updateField('difficulty', Number(e.target.value))} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900">
+                {[1,2,3,4,5].map(n => <option key={n} value={n}>Level {n}</option>)}
+              </select>
+            </div>
+            <div>
+              <label className="block text-sm font-medium mb-1">Stand</label>
+              <input type="date" value={draft.last_checked || ""} onChange={e=>updateField('last_checked', e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" />
+            </div>
+          </div>
+          <div>
+            <label className="block text-sm font-medium mb-1">Erl√§uterung</label>
+            <textarea value={draft.explain} onChange={e=>updateField('explain', e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" rows={3} placeholder="Hinweise und Begr√ºndung" />
+          </div>
+          <div className="flex justify-end gap-2">
+            <button type="button" onClick={onCancel} className="px-3 py-2 rounded-lg border dark:border-gray-600">Abbrechen</button>
+            <button type="submit" className="px-3 py-2 rounded-lg bg-blue-600 text-white">{submitLabel}</button>
+          </div>
+        </form>
+      );
+    }
+
+    function AdminPanel({ questions, setQuestions }){
+      const [mode, setMode] = useState("list");
+      const [draft, setDraft] = useState(null);
+      const [message, setMessage] = useState("");
+      const [error, setError] = useState("");
+
+      useEffect(() => {
+        if(message){
+          const t = setTimeout(() => setMessage(""), 4000);
+          return () => clearTimeout(t);
+        }
+      }, [message]);
+
+      const startEdit = (q) => {
+        setDraft({ ...q, choices:[...q.choices], correct:[...q.correct], tags:[...q.tags] });
+        setMode("edit");
+        setError("");
+      };
+
+      const startCreate = () => {
+        setDraft({ id:"", question:"", choices:["","","","",""], correct:[], explain:"", law_ref:"", tags:[], last_checked:new Date().toISOString().slice(0,10), difficulty:1 });
+        setMode("create");
+        setError("");
+      };
+
+      const cancel = () => {
+        setMode("list");
+        setDraft(null);
+      };
+
+      const validate = (data) => {
+        if(!data.question || !data.question.trim()) return "Fragetext darf nicht leer sein.";
+        if(!data.choices.every(c => c && c.trim())) return "Alle Antwortoptionen m√ºssen ausgef√ºllt sein.";
+        if(!data.correct.length) return "Mindestens eine Antwort muss als richtig markiert sein.";
+        return "";
+      };
+
+      const handleSubmit = () => {
+        if(!draft) return;
+        const normalized = {
+          ...draft,
+          id: draft.id.trim(),
+          question: draft.question.trim(),
+          choices: draft.choices.map(c => c.trim()),
+          correct: [...draft.correct].sort((a,b)=>a-b),
+          tags: draft.tags.map(t=>t.trim()).filter(Boolean),
+          law_ref: (draft.law_ref || "").trim(),
+          explain: (draft.explain || "").trim(),
+          last_checked: draft.last_checked || new Date().toISOString().slice(0,10),
+          difficulty: Number(draft.difficulty) || 1,
+        };
+        const validationError = validate(normalized);
+        if(validationError){ setError(validationError); return; }
+        if(mode === "edit"){
+          setQuestions(prev => prev.map(q => q.id === normalized.id ? normalized : q));
+          setMessage(`Frage ${normalized.id} aktualisiert.`);
+        } else {
+          let newId = normalized.id;
+          if(!newId){
+            const base = normalized.tags[0] ? normalized.tags[0].toLowerCase() : 'frage';
+            newId = generateId(base);
+          }
+          if(questions.some(q => q.id === newId)){
+            setError("Diese ID ist bereits vergeben.");
+            return;
+          }
+          setQuestions(prev => [...prev, { ...normalized, id: newId }]);
+          setMessage(`Neue Frage ${newId} hinzugef√ºgt.`);
+        }
+        setMode("list");
+        setDraft(null);
+        setError("");
+      };
+
+      const sortedQuestions = [...questions].sort((a,b) => a.id.localeCompare(b.id));
+
+      return (
+        <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-6 space-y-4">
+          <div className="flex items-center justify-between">
+            <h2 className="text-lg font-semibold">Adminbereich: Fragen verwalten</h2>
+            {mode === 'list' && (
+              <button onClick={startCreate} className="px-3 py-2 rounded-lg bg-green-600 text-white">Neue Frage</button>
+            )}
+          </div>
+          {message && <div className="text-sm text-green-600 dark:text-green-300">{message}</div>}
+          {error && <div className="text-sm text-red-600 dark:text-red-400">{error}</div>}
+          {mode === "list" ? (
+            <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
+              {sortedQuestions.map(q => (
+                <div key={q.id} className="p-3 border rounded-xl dark:border-gray-700 flex items-start justify-between gap-4">
+                  <div>
+                    <div className="text-sm font-semibold">{q.id}</div>
+                    <div className="text-sm text-gray-600 dark:text-gray-300">{q.question}</div>
+                    <div className="mt-1 text-xs text-gray-500 dark:text-gray-400">Tags: {q.tags.join(', ')} ¬∑ Stand: {q.last_checked}</div>
+                  </div>
+                  <button onClick={()=>startEdit(q)} className="px-3 py-2 rounded-lg border dark:border-gray-600">Bearbeiten</button>
+                </div>
+              ))}
+              {!sortedQuestions.length && <div className="text-sm text-gray-500">Keine Fragen vorhanden.</div>}
+            </div>
+          ) : (
+            <QuestionForm draft={draft} onChange={setDraft} onSubmit={handleSubmit} onCancel={cancel} submitLabel={mode==='edit' ? 'Speichern' : 'Erstellen'} disableId={mode==='edit'} />
+          )}
+        </div>
+      );
+    }
+
+    function UserApp({ activeUser, users, setUsers, setActiveUserId, theme, setTheme, questions, setQuestions }){
+      const userId = activeUser.id;
+      const [view, setView] = useUserLocalStorage(userId, "view", "dashboard");
+      const [mode, setMode] = useUserLocalStorage(userId, "mode", "training");
+      const [filter, setFilter] = useUserLocalStorage(userId, "filter", DEFAULT_FILTER);
+      const [review, setReview] = useUserLocalStorage(userId, "review", []);
+      const [metrics, setMetrics] = useUserLocalStorage(userId, "metrics", DEFAULT_METRICS);
+      const [score, setScore] = useUserLocalStorage(userId, "score", 0);
+      const [streak, setStreak] = useUserLocalStorage(userId, "streak", 0);
+      const [idx, setIdx] = useUserLocalStorage(userId, "idx", 0);
+      const [tierMap, setTierMap] = useUserLocalStorage(userId, "tiers", {});
       const [seed, setSeed] = useState(0);
-      const [filter, setFilter] = useLocalStorage("filter", { tags: [], difficulty: 0 });
-      const [review, setReview] = useLocalStorage("review", []);
-      const [metrics, setMetrics] = useLocalStorage("metrics", { totalAttempts: 0, totalCorrect: 0, attemptedIds: {}, correctIds: {} });
-      const [score, setScore] = useLocalStorage("score", 0);
-      const [streak, setStreak] = useLocalStorage("streak", 0);
-      const [idx, setIdx] = useLocalStorage("idx", 0);
       const [showExplain, setShowExplain] = useState(false);
-      const [theme, setTheme] = useLocalStorage("theme","light");
+      const [passwordFormOpen, setPasswordFormOpen] = useState(false);
+      const [passwordCurrent, setPasswordCurrent] = useState("");
+      const [passwordNew, setPasswordNew] = useState("");
+      const [passwordConfirm, setPasswordConfirm] = useState("");
+      const [passwordStatus, setPasswordStatus] = useState(null);
+
+      const resetPasswordForm = useCallback(() => {
+        setPasswordFormOpen(false);
+        setPasswordCurrent("");
+        setPasswordNew("");
+        setPasswordConfirm("");
+        setPasswordStatus(null);
+      }, []);
+
+      const openPasswordForm = useCallback(() => {
+        setPasswordFormOpen(true);
+        setPasswordCurrent("");
+        setPasswordNew("");
+        setPasswordConfirm("");
+        setPasswordStatus(null);
+      }, []);
+
+      useEffect(()=>{ setShowExplain(false); }, [idx, userId]);
+
       useEffect(()=>{
-        if(theme === "dark"){ document.documentElement.classList.add("dark"); }
-        else { document.documentElement.classList.remove("dark"); }
-      },[theme]);
+        if(view === 'admin' && activeUser.role !== 'admin'){
+          setView('dashboard');
+        }
+      }, [view, activeUser.role, setView]);
 
-      const pool = useMemo(()=>{
-        let p=QUESTIONS;
-        if (filter.tags?.length) p=p.filter(q=>q.tags.some(t=>filter.tags.includes(t)));
-        if (filter.difficulty) p=p.filter(q=>q.difficulty===filter.difficulty);
-        if (mode==="mission"){ const firstTag=filter.tags[0]||"BDG"; p=p.filter(q=>q.tags.includes(firstTag)); }
-        return weightedOrder(p);
-      },[mode,filter,seed,QUESTIONS]);
+      useEffect(() => {
+        resetPasswordForm();
+      }, [userId, resetPasswordForm]);
 
-      const current = pool[idx % (pool.length || 1)];
+      const attemptPasswordChange = useCallback((currentPlain, nextPlain) => {
+        const referenceHash = (users.find(u => u.id === userId)?.passwordHash) || activeUser.passwordHash || "";
+        if(!passwordsMatch(referenceHash, currentPlain)){
+          return { ok:false, error:"Aktuelles Passwort ist falsch." };
+        }
+        const nextHash = hashPassword(nextPlain);
+        setUsers(prev => prev.map(u => u.id === userId ? { ...u, passwordHash: nextHash } : u));
+        return { ok:true };
+      }, [users, userId, activeUser.passwordHash, setUsers]);
 
-      function submitAnswer(selectedDisplayIdx){
-        if(!current) return;
-        const displayOrder=getDisplayOrder(current.id,idx);
-        const toOriginal=(i)=>displayOrder[i];
-        const selectedOriginalIdx=selectedDisplayIdx.map(toOriginal);
-        const correctSet=new Set(current.correct);
-        const selectedSet=new Set(selectedOriginalIdx);
-        const allOptions=current.choices.map((_,i)=>i);
-        const isExact=allOptions.every(i=>correctSet.has(i)===selectedSet.has(i));
-        setShowExplain(true);
-        const curTier=getTier(current.id);
-        if(isExact){ setScore(s=>s+10); setStreak(s=>s+1); setReview(r=>r.filter(id=>id!==current.id)); setTier(current.id,curTier+1); }
-        else { setStreak(0); setReview(r=>(r.includes(current.id)?r:[...r,current.id])); setTier(current.id,curTier-1); }
-        setMetrics(m=>{
-          const attemptedIds = { ...(m?.attemptedIds || {}) };
-          const correctIds = { ...(m?.correctIds || {}) };
-          attemptedIds[current.id] = (attemptedIds[current.id] || 0) + 1;
-          if(isExact){
-            correctIds[current.id] = (correctIds[current.id] || 0) + 1;
-          }
-          return {
-            totalAttempts: (m?.totalAttempts || 0) + 1,
-            totalCorrect: (m?.totalCorrect || 0) + (isExact ? 1 : 0),
-            attemptedIds,
-            correctIds,
-          };
+      const submitPasswordChange = useCallback((e) => {
+        e.preventDefault();
+        setPasswordStatus(null);
+        if(passwordNew.length < 4){
+          setPasswordStatus({ type:"error", text:"Neues Passwort muss mindestens 4 Zeichen haben." });
+          return;
+        }
+        if(passwordNew !== passwordConfirm){
+          setPasswordStatus({ type:"error", text:"Neue Passw√∂rter stimmen nicht √ºberein." });
+          return;
+        }
+        const result = attemptPasswordChange(passwordCurrent, passwordNew);
+        if(!result.ok){
+          setPasswordStatus({ type:"error", text: result.error || "Aktualisierung fehlgeschlagen." });
+          return;
+        }
+        setPasswordStatus({ type:"success", text:"Passwort erfolgreich aktualisiert." });
+        setPasswordCurrent("");
+        setPasswordNew("");
+        setPasswordConfirm("");
+      }, [passwordNew, passwordConfirm, attemptPasswordChange, passwordCurrent]);
+
+      const safeFilterRaw = (filter && typeof filter === 'object') ? filter : cloneValue(DEFAULT_FILTER);
+      const filterTags = Array.isArray(safeFilterRaw.tags) ? safeFilterRaw.tags : [];
+      const filterDifficulty = Number(safeFilterRaw.difficulty) || 0;
+      const safeFilter = { tags: filterTags, difficulty: filterDifficulty };
+      const safeMetrics = (metrics && typeof metrics === 'object') ? metrics : cloneValue(DEFAULT_METRICS);
+      const safeReview = Array.isArray(review) ? review : [];
+
+      const getTier = useCallback((id) => {
+        const map = (tierMap && typeof tierMap === 'object') ? tierMap : {};
+        const value = map[id];
+        const tier = typeof value === 'number' ? value : 2;
+        return Math.max(1, Math.min(5, tier));
+      }, [tierMap]);
+
+      const adjustTier = useCallback((id, delta) => {
+        setTierMap(prev => {
+          const base = (prev && typeof prev === 'object') ? { ...prev } : {};
+          const current = typeof base[id] === 'number' ? base[id] : 2;
+          const next = Math.max(1, Math.min(5, current + delta));
+          base[id] = next;
+          return base;
         });
-      }
-      function next(){ setIdx(i=>i+1); setShowExplain(false);} 
-      const progress=((idx % (pool.length||1))/(pool.length||1))*100; const rank=rankFor(score);
+      }, [setTierMap]);
+
+      const pool = useMemo(() => {
+        let p = Array.isArray(questions) ? questions : [];
+        if (safeFilter.tags.length) p = p.filter(q => q.tags.some(t => safeFilter.tags.includes(t)));
+        if (safeFilter.difficulty) p = p.filter(q => q.difficulty === safeFilter.difficulty);
+        if (mode === "mission"){
+          const firstTag = safeFilter.tags?.[0] || "BDG";
+          p = p.filter(q => q.tags.includes(firstTag));
+        }
+        return weightedOrder(p, getTier);
+      }, [questions, safeFilter, mode, seed, getTier]);
+
+      const current = pool.length ? pool[idx % pool.length] : null;
+      const rank = rankFor(score || 0);
+      const progress = pool.length ? ((idx % pool.length) / pool.length) * 100 : 0;
 
       const stats = useMemo(()=>{
-        const safeMetrics = (metrics && typeof metrics === 'object') ? metrics : { totalAttempts:0, totalCorrect:0, attemptedIds:{}, correctIds:{} };
         const result={};
-        for(const g of GROUPS){
-          result[g.key]={ total:0, attempted:0, correct:0, color:g.color, title:g.title };
-        }
-        for(const q of QUESTIONS){
+        for(const g of GROUPS){ result[g.key]={ total:0, attempted:0, correct:0, color:g.color, title:g.title }; }
+        for(const q of Array.isArray(questions)?questions:[]){
           const group = GROUPS.find(g=>q.tags.some(t=>g.tags.includes(t))) || GROUPS[GROUPS.length-1];
           const key = group.key;
           result[key].total++;
@@ -288,21 +757,129 @@
           result[key].correct += correct;
         }
         return result;
-      },[QUESTIONS, metrics]);
+      }, [questions, safeMetrics]);
+
+      const submitAnswer = (selectedDisplayIdx) => {
+        if(!current) return;
+        const displayOrder = getDisplayOrder(current.id, idx);
+        const toOriginal = (i) => displayOrder[i];
+        const selectedOriginalIdx = selectedDisplayIdx.map(toOriginal);
+        const correctSet = new Set(current.correct);
+        const selectedSet = new Set(selectedOriginalIdx);
+        const allOptions = current.choices.map((_,i)=>i);
+        const isExact = allOptions.every(i=>correctSet.has(i)===selectedSet.has(i));
+        setShowExplain(true);
+        if(isExact){
+          setScore(s=> (s || 0) + 10);
+          setStreak(s=> (s || 0) + 1);
+          setReview(prev => {
+            const list = Array.isArray(prev) ? prev : [];
+            return list.filter(id => id !== current.id);
+          });
+          adjustTier(current.id, +1);
+        } else {
+          setStreak(0);
+          setReview(prev => {
+            const list = Array.isArray(prev) ? prev : [];
+            return list.includes(current.id) ? list : [...list, current.id];
+          });
+          adjustTier(current.id, -1);
+        }
+        setMetrics(m=>{
+          const base = (m && typeof m === 'object') ? m : cloneValue(DEFAULT_METRICS);
+          const attemptedIds = { ...(base.attemptedIds || {}) };
+          const correctIds = { ...(base.correctIds || {}) };
+          attemptedIds[current.id] = (attemptedIds[current.id] || 0) + 1;
+          if(isExact){
+            correctIds[current.id] = (correctIds[current.id] || 0) + 1;
+          }
+          return {
+            totalAttempts: (base.totalAttempts || 0) + 1,
+            totalCorrect: (base.totalCorrect || 0) + (isExact ? 1 : 0),
+            attemptedIds,
+            correctIds,
+          };
+        });
+      };
 
-      const metricsSafe = (metrics && typeof metrics === 'object') ? metrics : { totalAttempts:0, totalCorrect:0, attemptedIds:{}, correctIds:{} };
+      const next = () => {
+        setIdx(i => (i || 0) + 1);
+        setShowExplain(false);
+      };
+
+      const toggleTag = (tag) => {
+        setFilter(prev => {
+          const base = (prev && typeof prev === 'object') ? prev : cloneValue(DEFAULT_FILTER);
+          const currentTags = Array.isArray(base.tags) ? base.tags : [];
+          const exists = currentTags.includes(tag);
+          const tags = exists ? currentTags.filter(t=>t!==tag) : [...currentTags, tag];
+          return { ...base, tags };
+        });
+      };
+
+      const resetProgress = () => {
+        if(!window.confirm('Fortschritt wirklich f√ºr dieses Profil l√∂schen?')) return;
+        ['view','mode','filter','review','metrics','score','streak','idx','tiers'].forEach(key => localStorage.removeItem(`${userId}:${key}`));
+        setView('dashboard');
+        setMode('training');
+        setFilter(cloneValue(DEFAULT_FILTER));
+        setReview([]);
+        setMetrics(cloneValue(DEFAULT_METRICS));
+        setScore(0);
+        setStreak(0);
+        setIdx(0);
+        setTierMap({});
+        setSeed(s=>s+1);
+        setShowExplain(false);
+      };
+
+      const uniqueTags = Array.from(new Set(GROUPS.flatMap(g=>g.tags)));
 
       return (
-        <div className="max-w-5xl mx-auto p-6">
-          <header className="mb-6">
+        <div className="max-w-5xl mx-auto p-6 space-y-6">
+          <UserSwitcher users={users} activeUser={activeUser} onLogout={()=>setActiveUserId(null)} onSwitch={setActiveUserId} onChangePassword={openPasswordForm} />
+
+          {passwordFormOpen && (
+            <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-6">
+              <h3 className="font-semibold text-lg mb-4">Passwort √§ndern</h3>
+              <form onSubmit={submitPasswordChange} className="space-y-4">
+                <div>
+                  <label className="block text-sm font-medium mb-1">Aktuelles Passwort</label>
+                  <input type="password" value={passwordCurrent} onChange={e=>setPasswordCurrent(e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" />
+                </div>
+                <div>
+                  <label className="block text-sm font-medium mb-1">Neues Passwort</label>
+                  <input type="password" value={passwordNew} onChange={e=>setPasswordNew(e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" placeholder="mind. 4 Zeichen" />
+                </div>
+                <div>
+                  <label className="block text-sm font-medium mb-1">Neues Passwort best√§tigen</label>
+                  <input type="password" value={passwordConfirm} onChange={e=>setPasswordConfirm(e.target.value)} className="w-full px-3 py-2 rounded-lg border dark:border-gray-600 dark:bg-gray-900" />
+                </div>
+                {passwordStatus?.text && (
+                  <div className={`text-sm ${passwordStatus.type==='error' ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'}`}>
+                    {passwordStatus.text}
+                  </div>
+                )}
+                <div className="flex flex-wrap gap-2">
+                  <button type="submit" className="px-3 py-2 rounded-lg bg-blue-600 text-white">Speichern</button>
+                  <button type="button" onClick={resetPasswordForm} className="px-3 py-2 rounded-lg border dark:border-gray-600">Abbrechen</button>
+                </div>
+              </form>
+            </div>
+          )}
+
+          <header className="mb-2">
             <div className="rounded-2xl p-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow flex flex-wrap items-center gap-4 justify-between">
               <div>
                 <h1 className="text-2xl font-bold">Lerntool E1 / E2a</h1>
                 <p className="text-sm opacity-90">Pr√ºfungsrealistisches MC-Training ¬∑ 5 Optionen ¬∑ Mehrfachauswahl ¬∑ Antwortmischung ¬∑ Spaced Repetition</p>
               </div>
-              <div className="flex gap-2 items-center">
+              <div className="flex gap-2 items-center flex-wrap">
                 <button onClick={()=>setView('dashboard')} className={`px-3 py-1 rounded-full border ${view==='dashboard'? 'bg-white text-blue-700' : 'bg-transparent border-white text-white'}`}>Dashboard</button>
                 <button onClick={()=>setView('train')} className={`px-3 py-1 rounded-full border ${view==='train'? 'bg-white text-blue-700' : 'bg-transparent border-white text-white'}`}>Training</button>
+                {activeUser.role === 'admin' && (
+                  <button onClick={()=>setView('admin')} className={`px-3 py-1 rounded-full border ${view==='admin'? 'bg-white text-blue-700' : 'bg-transparent border-white text-white'}`}>Admin</button>
+                )}
                 <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className="px-3 py-1 rounded-full border bg-transparent border-white text-white hover:bg-white/10">
                   {theme==='dark' ? '‚òÄÔ∏è¬†Light' : 'üåô¬†Dark'}
                 </button>
@@ -310,16 +887,15 @@
             </div>
           </header>
 
-          {view==='dashboard' && (<Dashboard stats={stats} rank={rank} score={score} reviewCount={review.length || 0} />)}
+          {view==='dashboard' && (<Dashboard stats={stats} rank={rank} score={score} reviewCount={safeReview.length} />)}
 
           {view==='train' && (
             <>
-              {/* Kompakte Stats im Training */}
               <div className="mb-4 grid lg:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-4">
-                <StatCard title="Trefferquote" value={`${metricsSafe.totalAttempts? Math.round((metricsSafe.totalCorrect/metricsSafe.totalAttempts)*100):0}%`} sub={`Richtig ${metricsSafe.totalCorrect} ¬∑ Falsch ${Math.max(0, metricsSafe.totalAttempts - metricsSafe.totalCorrect)}`} />
-                <StatCard title="Beantwortet gesamt" value={metricsSafe.totalAttempts} sub={`${Object.keys(metricsSafe.attemptedIds||{}).length} unterschiedliche Fragen`} />
+                <StatCard title="Trefferquote" value={`${safeMetrics.totalAttempts? Math.round((safeMetrics.totalCorrect/safeMetrics.totalAttempts)*100):0}%`} sub={`Richtig ${safeMetrics.totalCorrect} ¬∑ Falsch ${Math.max(0, safeMetrics.totalAttempts - safeMetrics.totalCorrect)}`} />
+                <StatCard title="Beantwortet gesamt" value={safeMetrics.totalAttempts || 0} sub={`${Object.keys(safeMetrics.attemptedIds||{}).length} unterschiedliche Fragen`} />
                 <StatCard title="Streak" value={`${streak} üî•`} sub="in Folge richtig" />
-                <StatCard title="Rang" value={rankFor(score)} sub={`${score} XP`} />
+                <StatCard title="Rang" value={rankFor(score || 0)} sub={`${score || 0} XP`} />
               </div>
 
               <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
@@ -327,34 +903,28 @@
                   <div className="text-xs text-gray-500 dark:text-gray-400">Modus</div>
                   <div className="mt-2 flex flex-wrap gap-2">
                     {["training","exam","mission"].map(val => (
-                      <button key={val} onClick={() => {localStorage.setItem('mode', JSON.stringify(val));}} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${JSON.parse(localStorage.getItem('mode')||'"training"')===val?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{val}</button>
+                      <button key={val} onClick={() => setMode(val)} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${mode===val?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{val}</button>
                     ))}
                   </div>
                 </div>
                 <div className="p-4 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow">
                   <div className="text-xs text-gray-500 dark:text-gray-400">Filter</div>
                   <div className="mt-2 flex flex-wrap gap-2">
-                    {GROUPS.flatMap(g=>g.tags).filter((v,i,a)=>a.indexOf(v)===i).map(t => (
-                      <button key={t} onClick={() => {
-                        const f = JSON.parse(localStorage.getItem('filter')||'{"tags":[],"difficulty":0}');
-                        const exists = f.tags.includes(t);
-                        const tags = exists? f.tags.filter(x=>x!==t) : [...f.tags,t];
-                        localStorage.setItem('filter', JSON.stringify({...f,tags}));
-                        location.reload();
-                      }} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${ (JSON.parse(localStorage.getItem('filter')||'{"tags":[],"difficulty":0}').tags||[]).includes(t)?"bg-blue-100 border-blue-400":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{t}</button>
+                    {uniqueTags.map(t => (
+                      <button key={t} onClick={() => toggleTag(t)} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${ safeFilter.tags.includes(t)?"bg-blue-100 border-blue-400":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{t}</button>
                     ))}
                   </div>
                 </div>
                 <div className="p-4 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow">
                   <div className="text-xs text-gray-500 dark:text-gray-400">Einstellungen</div>
                   <div className="mt-2 flex flex-wrap gap-2">
-                <button className="px-3 py-1 rounded-lg border dark:border-gray-600" onClick={()=>{ ['tiers','answers','score','streak','idx','review','filter','mode','questions','metrics'].forEach(k=>localStorage.removeItem(k)); alert('Zur√ºckgesetzt. Seite l√§dt neu.'); location.reload(); }}>Fortschritt zur√ºcksetzen</button>
+                    <button className="px-3 py-1 rounded-lg border dark:border-gray-600" onClick={resetProgress}>Fortschritt zur√ºcksetzen</button>
                   </div>
                 </div>
               </div>
 
               {current ? (
-                <QuestionCard q={current} idx={idx} submitted={showExplain} onSubmit={submitAnswer} onNext={next} />
+                <QuestionCard q={current} idx={idx} submitted={showExplain} onSubmit={submitAnswer} onNext={next} getTier={getTier} />
               ) : (
                 <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-6">Keine Fragen im aktuellen Filter.</div>
               )}
@@ -364,8 +934,9 @@
                 <p className="text-sm text-gray-600 dark:text-gray-300 mb-3">Format: [{"{"}"id","question","choices":[5],"correct":[0,2,4],"explain":"...","law_ref":"...","tags":[...],"last_checked":"YYYY-MM-DD","difficulty":1{"}"}]</p>
                 <div className="flex gap-2 flex-wrap">
                   <button className="px-3 py-2 rounded-lg border dark:border-gray-600" onClick={() => {
-                    const blob = new Blob([JSON.stringify(QUESTIONS, null, 2)], { type: 'application/json' });
-                    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'fragenbank-demo.json'; a.click(); URL.revokeObjectURL(url);
+                    const blob = new Blob([JSON.stringify(questions, null, 2)], { type: 'application/json' });
+                    const url = URL.createObjectURL(blob);
+                    const a = document.createElement('a'); a.href = url; a.download = 'fragenbank-demo.json'; a.click(); URL.revokeObjectURL(url);
                   }}>Export</button>
 
                   <label className="px-3 py-2 rounded-lg border cursor-pointer dark:border-gray-600">Import
@@ -375,7 +946,6 @@
                         const data=JSON.parse(text);
                         const ok = Array.isArray(data) && data.every(q => q && typeof q.id==="string" && typeof q.question==="string" && Array.isArray(q.choices) && q.choices.length===5 && Array.isArray(q.correct) && q.correct.every(n=>Number.isInteger(n)&&n>=0&&n<5) && Array.isArray(q.tags));
                         if(!ok){ alert('Ung√ºltiges Format.'); return; }
-                        // In dieser Single-File-Demo ersetzen wir die DEFAULT_QUESTIONS nur im Speicher
                         setQuestions(data);
                         alert(`Import erfolgreich: ${data.length} Fragen √ºbernommen.`);
                       }catch{ alert('Ung√ºltiges JSON'); }
@@ -385,15 +955,32 @@
               </div>
             </>
           )}
+
+          {view==='admin' && activeUser.role === 'admin' && (
+            <AdminPanel questions={questions} setQuestions={setQuestions} />
+          )}
         </div>
       );
     }
 
-    // Fragenquelle zur Laufzeit: priorisiere Import
-    function Root(){
-      const [useImported, setUseImported] = useState(false);
-      useEffect(()=>{ if (window._IMPORTED_QUESTIONS) setUseImported(true); },[]);
-      return <App initialImported={useImported} />
+    function App(){
+      const { questions, setQuestions } = useQuestions();
+      const [users, setUsers] = useUsers();
+      const [activeUserId, setActiveUserId] = useLocalStorage("activeUserId", null);
+      const [theme, setTheme] = useLocalStorage("theme","light");
+
+      useEffect(()=>{
+        if(theme === "dark"){ document.documentElement.classList.add("dark"); }
+        else { document.documentElement.classList.remove("dark"); }
+      },[theme]);
+
+      const activeUser = users.find(u => u.id === activeUserId) || null;
+
+      if(!activeUser){
+        return <UserAuthPanel users={users} setUsers={setUsers} onLogin={setActiveUserId} theme={theme} setTheme={setTheme} />;
+      }
+
+      return <UserApp activeUser={activeUser} users={users} setUsers={setUsers} setActiveUserId={setActiveUserId} theme={theme} setTheme={setTheme} questions={questions} setQuestions={setQuestions} />;
     }
 
     ReactDOM.createRoot(document.getElementById('root')).render(<App />);
