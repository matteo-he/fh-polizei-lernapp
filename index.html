<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lerntool E1 / E2a</title>
  <!-- Tailwind √ºber CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' };</script>
  <!-- React & ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (damit JSX direkt im Browser funktioniert) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ========= Utility =========
    function xmur3(str){let h=1779033703^str.length;for(let i=0;i<str.length;i++){h=Math.imul(h^str.charCodeAt(i),3432918353);h=h<<13|h>>>19;}return function(){h=Math.imul(h^h>>>16,2246822507);h=Math.imul(h^h>>>13,3266489909);return (h^h>>>16)>>>0}}
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return ((t^t>>>14)>>>0)/4294967296}}
    function seededShuffle(array, seedStr){const seed=xmur3(seedStr)();const rng=mulberry32(seed);const a=[...array];for(let i=a.length-1;i>0;i--){const j=Math.floor(rng()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a}

    const COLOR = {
      BDG: { bg:"bg-yellow-50", border:"border-yellow-400", bar:"bg-yellow-400", grad:"from-yellow-400 to-amber-500", text:"text-yellow-700 dark:text-yellow-200" },
      SPG: { bg:"bg-blue-50",   border:"border-blue-500",   bar:"bg-blue-500",   grad:"from-blue-600 to-indigo-600", text:"text-blue-700 dark:text-blue-200" },
      StPO:{ bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
      StGB:{ bg:"bg-red-50",    border:"border-red-500",    bar:"bg-red-500",    grad:"from-rose-600 to-red-600", text:"text-red-700 dark:text-rose-200" },
      ADMIN:{ bg:"bg-green-50",  border:"border-green-600",  bar:"bg-green-600",  grad:"from-emerald-600 to-green-600", text:"text-green-700 dark:text-emerald-200" },
    };

    const GROUPS = [
      { key:"BDG",   title:"Dienstrecht (BDG)",           tags:["BDG"], color:COLOR.BDG },
      { key:"SPG",   title:"Sicherheitspolizei (SPG)",     tags:["SPG"], color:COLOR.SPG },
      { key:"STPO",  title:"Strafprozess/StGB",            tags:["StPO","StGB"], color:COLOR.StPO },
      { key:"ADMIN", title:"Verwaltung & Verkehr",          tags:["AVG","VStG","WaffG","StVO","KFG","FSG"], color:COLOR.ADMIN },
    ];

    const RANKS = [
      { title: "Anw√§rter:in", min: 0 },
      { title: "Inspektor:in", min: 150 },
      { title: "Gruppeninspektor:in", min: 400 },
      { title: "Revierinspektor:in", min: 800 },
      { title: "Abteilungsinspektor:in", min: 1300 },
      { title: "Chefinspektor:in", min: 2000 },
    ];

    const DEFAULT_QUESTIONS = [
      { id: "bdg-43-ma-1", question:"¬ß 43 BDG: Wie hat ein Beamter seine dienstlichen Aufgaben zu erf√ºllen? W√§hlen Sie alle zutreffenden.", choices:["Unter Beachtung der geltenden Rechtsordnung.","Treu, gewissenhaft, engagiert und unparteiisch.","Nur nach st√§ndiger R√ºcksprache mit dem unmittelbaren Vorgesetzten.","So, dass das Vertrauen der Allgemeinheit erhalten bleibt.","Prim√§r an interne Dienstanweisungen, nicht an Gesetze, gebunden."], correct:[0,1,3], explain:"¬ß 43 BDG: Rechtstreue, Gewissenhaftigkeit, Engagement, Unparteilichkeit und Wahrung des Vertrauens der Allgemeinheit.", law_ref:"BDG ¬ß 43", tags:["BDG"], last_checked:"2025-11-11", difficulty:1 },
      { id:"bdg-44-ma-1", question:"¬ß 44 BDG (Weisungen): In welchen F√§llen ist zu remonstrieren/abzulehnen? W√§hlen Sie alle zutreffenden.", choices:["Wenn die Weisung von einem unzust√§ndigen Organ erteilt wurde.","Wenn die Befolgung gegen verwaltungsrechtliche Vorschriften verstie√üe.","Wenn die Befolgung gegen strafrechtliche Vorschriften verstie√üe.","Wenn der Inhalt unklar ist und trotz Nachfrage unklar bleibt.","Wenn die Weisung m√ºndlich erteilt wurde."], correct:[0,1,2,3], explain:"Unzust√§ndigkeit oder Rechtswidrigkeit ‚Üí Remonstrationspflicht; M√ºndlichkeit allein macht eine Weisung nicht unbeachtlich.", law_ref:"BDG ¬ß 44", tags:["BDG"], last_checked:"2025-11-11", difficulty:2 },
      { id:"bdg-43a-ma-1", question:"¬ß 43a BDG (achtungsvoller Umgang): Welche Aussagen treffen zu? W√§hlen Sie alle zutreffenden.", choices:["Beamte haben menschenw√ºrdeverletzendes Verhalten zu unterlassen.","Vorgesetzte und Mitarbeiter begegnen einander mit Achtung.","Spontane Entgleisungen sind disziplin√§r immer irrelevant.","Vorgesetzte haben f√ºr achtungsvollen Umgang Sorge zu tragen.","¬ß 43a betrifft nur den Umgang mit Parteien."], correct:[0,1,3], explain:"¬ß 43a BDG verlangt w√ºrdevollen, diskriminierungsfreien Umgang; spontane Entgleisungen k√∂nnen relevant sein.", law_ref:"BDG ¬ß 43a", tags:["BDG"], last_checked:"2025-11-11", difficulty:1 },
      { id:"bdg-39-ma-1", question:"¬ß 39 BDG (Dienstzuteilung): Unter welchen Bedingungen ist eine Zuteilung ohne schriftliche Zustimmung √ºber 90 Tage zul√§ssig? W√§hlen Sie alle zutreffenden.", choices:["Wenn der Dienstbetrieb auf andere Weise nicht aufrechterhalten werden kann.","Wenn sie zum Zwecke einer Ausbildung erfolgt.","Wenn wichtige private Gr√ºnde vorliegen.","Wenn der Kommandant der entsendenden Dienststelle zustimmt.","Wenn der Kommandant der Zuteilungsdienststelle zustimmt."], correct:[0,1], explain:">90 Tage ohne Zustimmung: nur zur Aufrechterhaltung des Dienstbetriebs oder zu Ausbildungszwecken.", law_ref:"BDG ¬ß 39", tags:["BDG"], last_checked:"2025-11-11", difficulty:2 },
    ];

    // ========= Helpers =========
    function useLocalStorage(key, initial){
      const [state,setState]=useState(()=>{try{const s=localStorage.getItem(key);return s?JSON.parse(s):initial;}catch{return initial;}});
      useEffect(()=>{try{localStorage.setItem(key,JSON.stringify(state));}catch{}},[key,state]);
      return [state,setState];
    }

    function rankFor(score){const r=[...RANKS].reverse().find(r=>score>=r.min);return r? r.title : RANKS[0].title}

    function ProgressBar({ value, className="" }){
      return (
        <div className={`w-full h-2 bg-gray-200 rounded-full overflow-hidden ${className}`}>
          <div className="h-2 bg-blue-600 transition-all" style={{ width: `${Math.min(100, Math.max(0, value))}%` }} />
        </div>
      );
    }

    function Chip({ children, className="" }){
      return <span className={`px-2 py-1 text-xs rounded-full border mr-2 mb-2 inline-block ${className}`}>{children}</span>;
    }

    function StatCard({ title, value, sub }){
      return (
        <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow">
          <div className="text-xs text-gray-500 dark:text-gray-400">{title}</div>
          <div className="text-2xl font-semibold mt-1">{value}</div>
          {sub ? <div className="text-xs text-gray-500 dark:text-gray-400 mt-1">{sub}</div> : null}
        </div>
      );
    }

    // Tiers
    const MIN_TIER=1, MAX_TIER=5;
    const getTierMap=()=>{try{return JSON.parse(localStorage.getItem('tiers')||'{}')}catch{return{}}};
    const setTierMap=(m)=>{try{localStorage.setItem('tiers',JSON.stringify(m))}catch{}};
    const getTier=(id)=>{const m=getTierMap();return m[id]||2};
    const setTier=(id,t)=>{const m=getTierMap();m[id]=Math.max(MIN_TIER,Math.min(MAX_TIER,t));setTierMap(m)};
    const tierWeight=(tier)=>({1:5,2:3,3:2,4:1.2,5:1}[tier]||1);
    function weightedOrder(items){return [...items].map(x=>({x,k:Math.random()**(1/tierWeight(getTier(x.id)))})).sort((a,b)=>b.k-a.k).map(o=>o.x)}

    const getDisplayOrder=(qid,idx)=> seededShuffle([0,1,2,3,4], `${qid}#${idx}`);

    // Fragen-State (f√ºr echten Import/Export ersetzbar)
    function useQuestions(){
      const [questions, setQuestions] = React.useState(() => {
        try {
          const saved = JSON.parse(localStorage.getItem('questions') || 'null');
          return (saved && Array.isArray(saved)) ? saved : DEFAULT_QUESTIONS;
        } catch { return DEFAULT_QUESTIONS; }
      });
      React.useEffect(() => {
        try { localStorage.setItem('questions', JSON.stringify(questions)); } catch {}
      }, [questions]);
      return { questions, setQuestions };
    }

    function Dashboard({ stats, rank, score, reviewCount }){
      const cards = GROUPS.map(g=>({ ...stats[g.key], key:g.key }));
      return (
        <div className="space-y-6">
          <div className="grid md:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-4">
            {cards.map(c=>{
              const attemptedPct = c.total? Math.round((c.attempted/c.total)*100):0;
              const correctPct   = c.attempted? Math.round((c.correct/c.attempted)*100):0;
              return (
                <div key={c.key} className={`rounded-2xl p-4 border shadow ${c.color.bg} ${c.color.border} dark:bg-gray-800 dark:border-gray-700`}>
                  <div className={`text-sm font-semibold ${c.color.text}`}>{GROUPS.find(g=>g.key===c.key).title}</div>
                  <div className="mt-2 text-xs text-gray-600 dark:text-gray-300">Fragen: {c.total} ¬∑ Bearbeitet: {c.attempted} ¬∑ Richtig: {c.correct}</div>
                  <div className="mt-3">
                    <div className="text-xs mb-1">Abdeckung</div>
                    <div className="w-full h-2 bg-white/70 rounded-full overflow-hidden border">
                      <div className={`h-2 ${c.color.bar}`} style={{ width: `${attemptedPct}%`}} />
                    </div>
                  </div>
                  <div className="mt-2">
                    <div className="text-xs mb-1">Trefferquote</div>
                    <div className="w-full h-2 bg-white/70 rounded-full overflow-hidden border">
                      <div className={`h-2 ${c.color.bar}`} style={{ width: `${correctPct}%`}} />
                    </div>
                  </div>
                </div>
              )
            })}
          </div>
          <div className="grid md:grid-cols-3 gap-4">
            <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow"><div className="text-xs text-gray-500 dark:text-gray-400">Aktueller Rang</div><div className="text-2xl font-bold mt-1">{rank}</div></div>
            <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow"><div className="text-xs text-gray-500 dark:text-gray-400">Gesamtpunkte</div><div className="text-2xl font-bold mt-1">{score}</div></div>
            <div className="rounded-2xl p-4 bg-white dark:bg-gray-800 dark:text-gray-100 shadow"><div className="text-xs text-gray-500 dark:text-gray-400">Wiederholungs-Queue</div><div className="text-2xl font-bold mt-1">{reviewCount}</div></div>
          </div>
        </div>
      );
    }

    function QuestionCard({ q, idx, submitted, onSubmit, onNext }){
      const [selectedDisplay, setSelectedDisplay] = useState([]);
      const displayOrder = useMemo(()=> getDisplayOrder(q.id, idx), [q.id, idx]);
      useEffect(()=>{ setSelectedDisplay([]); }, [q.id, idx]);
      const toggle = (dispIdx) => setSelectedDisplay(prev => prev.includes(dispIdx)? prev.filter(x=>x!==dispIdx):[...prev, dispIdx]);
      const correctSet = new Set(q.correct);
      const group = GROUPS.find(g=>q.tags.some(t=>g.tags.includes(t))) || GROUPS[GROUPS.length-1];
      return (
        <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-0 overflow-hidden">
          <div className={`h-2 w-full bg-gradient-to-r ${group.color.grad}`} />
          <div className="p-6">
            <div className="mb-3 text-xs text-gray-500 dark:text-gray-400 flex flex-wrap items-center gap-2">
              {q.tags.map(t => (<Chip key={t} className={`${group.color.bg} ${group.color.border} ${group.color.text}`}>{t}</Chip>))}
              <Chip>Schwierigkeit {q.difficulty}</Chip>
              <Chip>Stand {q.last_checked}</Chip>
              <Chip>Tier {getTier(q.id)}</Chip>
            </div>
            <h2 className="text-lg font-semibold mb-4">{q.question}</h2>
            <div className="grid gap-2">
              {displayOrder.map((origIdx, dispIdx) => {
                const isChosen = selectedDisplay.includes(dispIdx);
                const isCorrect = correctSet.has(origIdx);
                const show = submitted;
                let classes = "text-left px-4 py-3 rounded-xl border transition flex items-start gap-3 dark:border-gray-700";
                if (show) {
                  if (isCorrect) {
                    classes += " border-green-600 bg-green-50 dark:border-green-400 dark:bg-green-900/40";
                  } else if (isChosen) {
                    classes += " border-red-600 bg-red-50 dark:border-red-400 dark:bg-red-900/40";
                  } else {
                    classes += " bg-white dark:bg-gray-800";
                  }
                } else {
                  classes += " bg-white hover:bg-gray-50 dark:bg-gray-800 dark:hover:bg-gray-700";
                }
                return (
                  <label key={dispIdx} className={classes}>
                    <input type="checkbox" className="mt-1" disabled={submitted} checked={isChosen} onChange={()=>toggle(dispIdx)} />
                    <span><span className="font-medium mr-2">{String.fromCharCode(65+dispIdx)}.</span>{q.choices[origIdx]}</span>
                  </label>
                );
              })}
            </div>
            {!submitted ? (
              <div className="mt-4 flex gap-2">
                <button className="px-3 py-2 rounded-lg border dark:border-gray-600" onClick={() => onSubmit(selectedDisplay)}>Antwort abgeben</button>
                <button className="px-3 py-2 rounded-lg border dark:border-gray-600" onClick={onNext}>√úberspringen</button>
              </div>
            ) : (
              <div className="mt-4 p-4 border rounded-xl bg-gray-50 dark:bg-gray-900 dark:border-gray-700">
                <div className="text-sm">
                  <div className="font-semibold mb-1">Aufl√∂sung & Erl√§uterung</div>
                  <p className="mb-2">{q.explain}</p>
                  <div className="text-xs text-gray-600 dark:text-gray-300">Rechtsgrundlage: {q.law_ref}</div>
                </div>
                <div className="mt-3 flex gap-2">
                  <button className="px-3 py-2 rounded-lg border" onClick={onNext}>Weiter</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    function App(){
      const { questions: QUESTIONS, setQuestions } = useQuestions();
      const [view, setView] = useLocalStorage("view","dashboard");
      const [mode, setMode] = useLocalStorage("mode","training");
      const [seed, setSeed] = useState(0);
      const [filter, setFilter] = useLocalStorage("filter", { tags: [], difficulty: 0 });
      const [review, setReview] = useLocalStorage("review", []);
      const [metrics, setMetrics] = useLocalStorage("metrics", { totalAttempts: 0, totalCorrect: 0, attemptedIds: {}, correctIds: {} });
      const [score, setScore] = useLocalStorage("score", 0);
      const [streak, setStreak] = useLocalStorage("streak", 0);
      const [idx, setIdx] = useLocalStorage("idx", 0);
      const [showExplain, setShowExplain] = useState(false);
      const [theme, setTheme] = useLocalStorage("theme","light");
      useEffect(()=>{
        if(theme === "dark"){ document.documentElement.classList.add("dark"); }
        else { document.documentElement.classList.remove("dark"); }
      },[theme]);

      const pool = useMemo(()=>{
        let p=QUESTIONS;
        if (filter.tags?.length) p=p.filter(q=>q.tags.some(t=>filter.tags.includes(t)));
        if (filter.difficulty) p=p.filter(q=>q.difficulty===filter.difficulty);
        if (mode==="mission"){ const firstTag=filter.tags[0]||"BDG"; p=p.filter(q=>q.tags.includes(firstTag)); }
        return weightedOrder(p);
      },[mode,filter,seed,QUESTIONS]);

      const current = pool[idx % (pool.length || 1)];

      function submitAnswer(selectedDisplayIdx){
        if(!current) return;
        const displayOrder=getDisplayOrder(current.id,idx);
        const toOriginal=(i)=>displayOrder[i];
        const selectedOriginalIdx=selectedDisplayIdx.map(toOriginal);
        const correctSet=new Set(current.correct);
        const selectedSet=new Set(selectedOriginalIdx);
        const allOptions=current.choices.map((_,i)=>i);
        const isExact=allOptions.every(i=>correctSet.has(i)===selectedSet.has(i));
        setShowExplain(true);
        const curTier=getTier(current.id);
        if(isExact){ setScore(s=>s+10); setStreak(s=>s+1); setReview(r=>r.filter(id=>id!==current.id)); setTier(current.id,curTier+1); }
        else { setStreak(0); setReview(r=>(r.includes(current.id)?r:[...r,current.id])); setTier(current.id,curTier-1); }
        setMetrics(m=>{
          const attemptedIds = { ...(m?.attemptedIds || {}) };
          const correctIds = { ...(m?.correctIds || {}) };
          attemptedIds[current.id] = (attemptedIds[current.id] || 0) + 1;
          if(isExact){
            correctIds[current.id] = (correctIds[current.id] || 0) + 1;
          }
          return {
            totalAttempts: (m?.totalAttempts || 0) + 1,
            totalCorrect: (m?.totalCorrect || 0) + (isExact ? 1 : 0),
            attemptedIds,
            correctIds,
          };
        });
      }
      function next(){ setIdx(i=>i+1); setShowExplain(false);} 
      const progress=((idx % (pool.length||1))/(pool.length||1))*100; const rank=rankFor(score);

      const stats = useMemo(()=>{
        const safeMetrics = (metrics && typeof metrics === 'object') ? metrics : { totalAttempts:0, totalCorrect:0, attemptedIds:{}, correctIds:{} };
        const result={};
        for(const g of GROUPS){
          result[g.key]={ total:0, attempted:0, correct:0, color:g.color, title:g.title };
        }
        for(const q of QUESTIONS){
          const group = GROUPS.find(g=>q.tags.some(t=>g.tags.includes(t))) || GROUPS[GROUPS.length-1];
          const key = group.key;
          result[key].total++;
          const attempts = safeMetrics.attemptedIds?.[q.id] || 0;
          const correct = safeMetrics.correctIds?.[q.id] || 0;
          result[key].attempted += attempts;
          result[key].correct += correct;
        }
        return result;
      },[QUESTIONS, metrics]);

      const metricsSafe = (metrics && typeof metrics === 'object') ? metrics : { totalAttempts:0, totalCorrect:0, attemptedIds:{}, correctIds:{} };

      return (
        <div className="max-w-5xl mx-auto p-6">
          <header className="mb-6">
            <div className="rounded-2xl p-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow flex flex-wrap items-center gap-4 justify-between">
              <div>
                <h1 className="text-2xl font-bold">Lerntool E1 / E2a</h1>
                <p className="text-sm opacity-90">Pr√ºfungsrealistisches MC-Training ¬∑ 5 Optionen ¬∑ Mehrfachauswahl ¬∑ Antwortmischung ¬∑ Spaced Repetition</p>
              </div>
              <div className="flex gap-2 items-center">
                <button onClick={()=>setView('dashboard')} className={`px-3 py-1 rounded-full border ${view==='dashboard'? 'bg-white text-blue-700' : 'bg-transparent border-white text-white'}`}>Dashboard</button>
                <button onClick={()=>setView('train')} className={`px-3 py-1 rounded-full border ${view==='train'? 'bg-white text-blue-700' : 'bg-transparent border-white text-white'}`}>Training</button>
                <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className="px-3 py-1 rounded-full border bg-transparent border-white text-white hover:bg-white/10">
                  {theme==='dark' ? '‚òÄÔ∏è¬†Light' : 'üåô¬†Dark'}
                </button>
              </div>
            </div>
          </header>

          {view==='dashboard' && (<Dashboard stats={stats} rank={rank} score={score} reviewCount={review.length || 0} />)}

          {view==='train' && (
            <>
              {/* Kompakte Stats im Training */}
              <div className="mb-4 grid lg:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-4">
                <StatCard title="Trefferquote" value={`${metricsSafe.totalAttempts? Math.round((metricsSafe.totalCorrect/metricsSafe.totalAttempts)*100):0}%`} sub={`Richtig ${metricsSafe.totalCorrect} ¬∑ Falsch ${Math.max(0, metricsSafe.totalAttempts - metricsSafe.totalCorrect)}`} />
                <StatCard title="Beantwortet gesamt" value={metricsSafe.totalAttempts} sub={`${Object.keys(metricsSafe.attemptedIds||{}).length} unterschiedliche Fragen`} />
                <StatCard title="Streak" value={`${streak} üî•`} sub="in Folge richtig" />
                <StatCard title="Rang" value={rankFor(score)} sub={`${score} XP`} />
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                <div className="p-4 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow">
                  <div className="text-xs text-gray-500 dark:text-gray-400">Modus</div>
                  <div className="mt-2 flex flex-wrap gap-2">
                    {["training","exam","mission"].map(val => (
                      <button key={val} onClick={() => {localStorage.setItem('mode', JSON.stringify(val));}} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${JSON.parse(localStorage.getItem('mode')||'"training"')===val?"bg-blue-600 text-white":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{val}</button>
                    ))}
                  </div>
                </div>
                <div className="p-4 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow">
                  <div className="text-xs text-gray-500 dark:text-gray-400">Filter</div>
                  <div className="mt-2 flex flex-wrap gap-2">
                    {GROUPS.flatMap(g=>g.tags).filter((v,i,a)=>a.indexOf(v)===i).map(t => (
                      <button key={t} onClick={() => {
                        const f = JSON.parse(localStorage.getItem('filter')||'{"tags":[],"difficulty":0}');
                        const exists = f.tags.includes(t);
                        const tags = exists? f.tags.filter(x=>x!==t) : [...f.tags,t];
                        localStorage.setItem('filter', JSON.stringify({...f,tags}));
                        location.reload();
                      }} className={`px-3 py-1 rounded-full border dark:border-gray-600 ${ (JSON.parse(localStorage.getItem('filter')||'{"tags":[],"difficulty":0}').tags||[]).includes(t)?"bg-blue-100 border-blue-400":"bg-white dark:bg-gray-700 dark:text-gray-100"}`}>{t}</button>
                    ))}
                  </div>
                </div>
                <div className="p-4 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow">
                  <div className="text-xs text-gray-500 dark:text-gray-400">Einstellungen</div>
                  <div className="mt-2 flex flex-wrap gap-2">
                <button className="px-3 py-1 rounded-lg border dark:border-gray-600" onClick={()=>{ ['tiers','answers','score','streak','idx','review','filter','mode','questions','metrics'].forEach(k=>localStorage.removeItem(k)); alert('Zur√ºckgesetzt. Seite l√§dt neu.'); location.reload(); }}>Fortschritt zur√ºcksetzen</button>
                  </div>
                </div>
              </div>

              {current ? (
                <QuestionCard q={current} idx={idx} submitted={showExplain} onSubmit={submitAnswer} onNext={next} />
              ) : (
                <div className="bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-6">Keine Fragen im aktuellen Filter.</div>
              )}

              <div className="mt-8 bg-white dark:bg-gray-800 dark:text-gray-100 rounded-2xl shadow p-6">
                <h3 className="font-semibold mb-2">Fragen importieren/exportieren (JSON)</h3>
                <p className="text-sm text-gray-600 dark:text-gray-300 mb-3">Format: [{"{"}"id","question","choices":[5],"correct":[0,2,4],"explain":"...","law_ref":"...","tags":[...],"last_checked":"YYYY-MM-DD","difficulty":1{"}"}]</p>
                <div className="flex gap-2 flex-wrap">
                  <button className="px-3 py-2 rounded-lg border dark:border-gray-600" onClick={() => {
                    const blob = new Blob([JSON.stringify(QUESTIONS, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'fragenbank-demo.json'; a.click(); URL.revokeObjectURL(url);
                  }}>Export</button>

                  <label className="px-3 py-2 rounded-lg border cursor-pointer dark:border-gray-600">Import
                    <input type="file" accept="application/json" className="hidden" onChange={async (e)=>{
                      const file=e.target.files?.[0]; if(!file) return; const text=await file.text();
                      try{
                        const data=JSON.parse(text);
                        const ok = Array.isArray(data) && data.every(q => q && typeof q.id==="string" && typeof q.question==="string" && Array.isArray(q.choices) && q.choices.length===5 && Array.isArray(q.correct) && q.correct.every(n=>Number.isInteger(n)&&n>=0&&n<5) && Array.isArray(q.tags));
                        if(!ok){ alert('Ung√ºltiges Format.'); return; }
                        // In dieser Single-File-Demo ersetzen wir die DEFAULT_QUESTIONS nur im Speicher
                        setQuestions(data);
                        alert(`Import erfolgreich: ${data.length} Fragen √ºbernommen.`);
                      }catch{ alert('Ung√ºltiges JSON'); }
                    }}/>
                  </label>
                </div>
              </div>
            </>
          )}
        </div>
      );
    }

    // Fragenquelle zur Laufzeit: priorisiere Import
    function Root(){
      const [useImported, setUseImported] = useState(false);
      useEffect(()=>{ if (window._IMPORTED_QUESTIONS) setUseImported(true); },[]);
      return <App initialImported={useImported} />
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
